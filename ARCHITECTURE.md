# AgriConnect - System Architecture

````
┌─────────────────────────────────────────────────────────────────────────────┐
│                              FRONTEND (React + Vite)                        │
│                         http://localhost:5173                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │








































































































































































































































































═════════════════════════════════════════════════════════════════════════════         └─ Business rules         ├─ Type checking         ├─ Pydantic modelsLayer 5: Input Validation         └─ Role-based queries         ├─ User-specific access         ├─ Row-level policiesLayer 4: Database RLS         └─ Resource ownership         ├─ Endpoint permissions         ├─ User role verificationLayer 3: Role-Based Access         └─ Signature verification         ├─ Expiry checking         ├─ Token validationLayer 2: JWT Authentication         └─ Credentials required         ├─ Allowed origins onlyLayer 1: CORS Protection═════════════════════════════════════════════════════════════════════════════                      SECURITY LAYERS═════════════════════════════════════════════════════════════════════════════       └─ Access analytics       ├─ Manage platform       ├─ List all orders       ├─ List all users       ├─ View statistics       │ Can:└──────┬──────┘│    Admin    │┌─────────────┐       └─ Respond to bulk orders       ├─ Update order status       ├─ View sales orders       ├─ Upload images       ├─ Delete products       ├─ Update products       ├─ Create products       │ Can:└──────┬──────┘│   Farmer    │┌─────────────┐       └─ Leave reviews       ├─ Submit bulk orders       ├─ Create subscriptions       ├─ View order history       ├─ Place orders       ├─ Add to cart       ├─ Browse products       │ Can:└──────┬──────┘│   Consumer  │┌─────────────┐═════════════════════════════════════════════════════════════════════════════                         ROLE-BASED ACCESS═════════════════════════════════════════════════════════════════════════════                       └────────────┘                       │ Request    │                       │ Retry      │                       ┌────────────┐                             ▼                             │                       └─────┬──────┘                       │ Token      │                       │ Access     │                       │ Get New    │                       ┌────────────┐                             ▼                             │ Yes          └────────────┘   └────────────┘      └─────┬──────┘       │ to Login   │   │ Request    │      │ Valid?     │──────▶│ Redirect   │   │ Process    │      ┌────────────┐  No   ┌────────────┐   ┌────────────┐            ▼       ▼                     │       │ Yes        └────────┬────────┘   └───┬────┘       │ Token           │   │ Valid? │──────▶│ Send Refresh    │   ┌────────┐  No   ┌─────────────────┐        ▼        │└───────┬───────────────┘│ <access_token>        ││ Authorization: Bearer ││ API Requests          │┌───────────────────────┐         ▼         │└────────┬─────────┘│ localStorage     ││ Store in         │┌──────────────────┐         ▼         │└────────┬────────┘│                 │ ─── Refresh Token (7 day expiry)│ Get JWT Tokens  │ ─── Access Token (30 min expiry)┌─────────────────┐      ▼      │└─────┬────┘│ Register ││  Login/  │┌──────────┐═════════════════════════════════════════════════════════════════════════════                         AUTHENTICATION FLOW═════════════════════════════════════════════════════════════════════════════   └─────────┘                 └─────────┘   │         │◀─ Image URL ────│         │              └─────────┘   │         │ ──────────────▶│         │◀─ Public URL─│         │   │         │ + File + JWT    │         │   Upload ───▶│         │   │Frontend │ product-image   │ Backend │   Optimize  │ Storage │   ┌─────────┐ POST /upload/   ┌─────────┐   Resize    ┌─────────┐5. IMAGE UPLOAD   └─────────┘                 └─────────┘               └─────────┘   │         │◀─ Order ────────│         │               │         │   │         │                 │         │◀─ Order ──────│         │   │         │                 │         │ Clear Cart ────▶       │   │         │                 │         │ Decrement Stock        │   │         │                 │         │ Create Order Items     │   │         │                 │         │ Create Order ─▶        │   │         │                 │         │ Calculate Total        │   │         │                 │         │ Validate Stock         │   │         │                 │         │              │         │   │         │                 │         │◀─ Cart Items─│         │   │         │                 │         │ Get Cart ────▶│         │   │Frontend │ ───────────────▶│ Backend │              │Database │   ┌─────────┐ POST /orders    ┌─────────┐              ┌─────────┐4. PLACE ORDER (Consumer)   └─────────┘                 └─────────┘              └─────────┘   │         │◀─ Product ──────│         │◀─ Product ───│         │   │ (Farmer)│ ──────────────▶│         │ Insert ──────▶│         │   │Frontend │ + JWT Token     │ Backend │ Validate     │Database │   ┌─────────┐ POST /products  ┌─────────┐  Check Role  ┌─────────┐3. PRODUCT CREATION (Farmer)   └─────────┘                             │         │◀─ JWT Tokens ────────────   User in DB    ────┘   │         │ ──────────────────────── ▶  Create/Update     │   │         │  POST /auth/google       │                └──────────┘   │         │◀─ Token ───────│        │   Get Profile  │          │   │Frontend │ ──────────────▶│ Google │◀───────────────│  Backend │   ┌─────────┐  Google Login  ┌────────┐  Verify Token  ┌──────────┐2. GOOGLE OAUTH LOGIN   └─────────┘                          └─────────┘                 └─────────┘   │         │◀─ JWT Tokens + User ────│         │◀─ User Record ──│         │   │Frontend │ ─────────────────────── ▶│ Backend │ ──────────────▶│Database │   ┌─────────┐   POST /auth/register   ┌─────────┐   Insert User   ┌─────────┐1. USER REGISTRATION (Email/Password)═════════════════════════════════════════════════════════════════════════════                            DATA FLOW EXAMPLES═════════════════════════════════════════════════════════════════════════════└─────────────────────────────┘│ • Auto-timestamps           ││ • Indexes                   ││ • Triggers & Functions      ││ • Foreign Keys              ││ • Row Level Security (RLS)  ││ Features:                   ││                             │  └───────────────────────────┘│ • notifications             │  │ • Profile Data            ││ • reviews                   │  │ • Token Verification      ││ • bulk_order_responses      │  │ • User Authentication     ││ • bulk_order_items          │  ├───────────────────────────┤│ • bulk_orders               │  │   GOOGLE OAUTH 2.0        ││ • subscription_items        │  ┌───────────────────────────┐│ • subscriptions             ││ • order_items               │  └───────────────────────────┘│ • orders                    │  │                           ││ • addresses                 │  │ Image Optimization        ││ • cart_items                │  │ Public Access             ││ • carts                     │  │                           ││ • products                  │  │ • profiles/               ││ • users                     │  │ • products/               ││ Tables (14):                │  │ Buckets:                  │├─────────────────────────────┤  ├───────────────────────────┤│   (PostgreSQL)              │  │   (S3-compatible)         ││   SUPABASE DATABASE         │  │   SUPABASE STORAGE        │┌───────────────────▼─────────┐  ┌────────▼──────────────────┐                    │                     │                    ┌──────────┴──────────┐                               │└──────────────────────────────┼─────────────────────────────────────────────┘│                              │                                             ││  └───────────────────────────┬───────────────────────────────────────────┘ ││  │  • Configuration Management                                           │ ││  │  • Supabase Client (Database & Storage)                               │ ││  │  • Security (JWT, OAuth, Password Hashing)                            │ ││  │                      Core Services                                    │ ││  ┌───────────────────────────▼───────────────────────────────────────────┐ ││                              │                                             ││        └───────────┴──────────┴─────────┴───────────┘                    ││        │           │          │         │           │                    ││  └─────┬──────┴────┬────┴─────┬────┴────┬─────┴─────┬─────┴───────────┘  ││  │  (5 API)   │ (4 API) │ (2 API)  │ (3 API)  │ (4 API)   │           │  ││  │ Endpoints  │ Orders  │ Endpoints│ Endpoints│ Endpoints │ 47 APIs   │  ││  │Subscript.  │ Bulk    │ Reviews  │  Notif.  │  Admin    │  Total:   │  ││  ┌─────┴──────┬────┴────┬────┴─────┬───┴──────┬────┴──────┬────┴──────┐  ││        │           │         │         │           │           │         ││  └─────┬─────┴─────┬─────┴───┬───┴─────┬─────┴─────┬─────┴─────┬─────┘   ││  │  (7 API)  │  (5 API)  │ (5 A) │  (5 API)  │  (5 API)  │  (2 API)  │   ││  │ Endpoints │ Endpoints │ Endpt │ Endpoints │ Endpoints │ Endpoints │   ││  │   Auth    │ Products  │ Cart  │  Orders   │   Users   │  Upload   │   ││  ┌───────────┬───────────┬───┴───┬───────────┬───────────┬───────────┐   ││                              │                                             ││  └───────────────────────────┬───────────────────────────────────────────┘ ││  │              (JWT Validation, Role Checking)                          │ ││  │                    Authentication Middleware                          │ ││  ┌───────────────────────────▼───────────────────────────────────────────┐ ││                              │                                             ││  └───────────────────────────┬───────────────────────────────────────────┘ ││  │                     /api/v1/*                                         │ ││  │                         API Router                                    │ ││  ┌───────────────────────────────────────────────────────────────────────┐ ││                                                                             │├─────────────────────────────────────────────────────────────────────────────┤│                        http://localhost:8000                                ││                        BACKEND (FastAPI + Python)                           │┌────────────────────────────────────▼────────────────────────────────────────┐                                     │                          JWT Bearer Tokens                            HTTP/REST API                                     │└────────────────────────────────────┼────────────────────────────────────────┘│                                    │                                        ││                         └──────────┬──────────┘                            ││                         │ (API Client + Auth) │                            ││                         │   Service Layer     │                            ││                         ┌──────────▼──────────┐                            ││                                    │                                        ││                         └──────────┬──────────┘                            ││                         │   React Components   │                            ││                         ┌──────────▼──────────┐                            ││                                    │                                        ││         └──────────────────┴──────────────────┴──────────────────┘          ││         │                  │                  │                  │          ││  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  ││  │    Pages     │  │    Pages     │  │    Pages     │  │    Pages     │  ││  │   Consumer   │  │    Farmer    │  │    Admin     │  │    Guest     │  ││  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │```
````
